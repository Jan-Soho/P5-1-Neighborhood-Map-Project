function getInitialPlaces(){var a="https://api.foursquare.com/v2/venues/explore?ll=48.5834513,7.743634&section=topPicks&limit="+locationLimit+"&radius=550&client_id="+FOURSQUARE_ID+"&client_secret="+FOURSQUARE_CLIENT+"&v=20130815";$.ajax({url:a,dataType:"jsonp"}).done(function(a){buildInitialPlace(a.response.groups[0].items)}).fail(function(a,b){$("#content").hide(),$(".error-msg").show("slow")})}function buildInitialPlace(a){var b=a;b.forEach(function(a){var b={};b.id=a.venue.id,b.name=a.venue.name,b.category=a.venue.categories[0].name,b.icon=a.venue.categories[0].icon.prefix+"bg_32.png",b.lat=a.venue.location.lat,b.lng=a.venue.location.lng,b.address=a.venue.location.address,b.phone=a.venue.contact.phone,b.fb=a.venue.contact.facebook,b.url=a.venue.url,b.rating=a.venue.rating,b.photos=[],b.isVisible=!0,b.isFavorite=!1;var c="https://api.foursquare.com/v2/venues/"+b.id+"/photos?limit=5&client_id="+FOURSQUARE_ID+"&client_secret="+FOURSQUARE_CLIENT+"&v=20160301",d=[];$.ajax({url:c,dataType:"jsonp"}).done(function(a){d=a.response.photos.items,d.forEach(function(a){b.photos.push(a.prefix+"width300"+a.suffix)}),initialPlaces.push(b),initialPlaces.length===locationLimit&&(localStorage.initialPlaces=JSON.stringify(initialPlaces),applyKo(),$("#content").fadeIn("fast"))}).fail(function(a,b){$("#content").hide(),$(".error-msg").show("slow")})})}function launchMap(){localStorage.initialPlaces?(initMap(),applyKo()):(initMap(),getInitialPlaces())}function applyKo(){ko.applyBindings(new ViewModel),$("#content").fadeIn("fast")}function initMap(){var a=document.getElementById("gmap");map=new google.maps.Map(a,{center:{lat:48.5834513,lng:7.743634},zoom:15,mapTypeControl:!1}),map.set("styles",[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#ff6a6a"},{lightness:"0"}]},{featureType:"road.highway",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"road.arterial",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ff6a6a"},{lightness:"75"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:"75"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"transit.station.bus",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"transit.station.rail",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"transit.station.rail",elementType:"labels.icon",stylers:[{weight:"0.01"},{hue:"#ff0028"},{lightness:"0"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{color:"#80e4d8"},{lightness:"25"},{saturation:"-23"}]}])}function makeMarker(a){if(a.isVisible()){var b=a.icon(),c=new google.maps.Marker({position:{lat:a.lat(),lng:a.lng()},map:map,animation:google.maps.Animation.DROP,title:a.name(),icon:b});c.addListener("click",toggleBounce);var d="",e="";a.fb()&&(d='<a class="network-link" target="_blank" href="https://www.facebook.com/'+a.fb()+'"><img src="img/FB-f-Logo__blue_29.png"/></a>'),a.url()&&(e='<a class="network-link" target="_blank" href="'+a.url()+'"><img src="img/web-site.png"/></a>'),a.phone()||a.phone(""),a.address()||a.address("");for(var f=a.photos(),g="",h=0;h<f.length;h++)g+='<a href="#" data-featherlight="'+f[h]+'"><img class="info-thumbnail" alt="2" src="'+f[h]+'"></a>';var i='<div id="info-content"><div class="info-image" title="Based on foursquare.com ratings"style="background-image: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.2)), url('+a.photos()[0]+');"><span class="info-rating">'+a.rating()+'</span></div><div class="info-text"><div class="info-title">'+a.name()+'</div><div class="info-address">'+a.address()+'</div><div class="info-category">'+a.category()+'</div><div class="info-photos">'+g+'</div><div class="network-info">'+d+e+'<span class="info-phone">'+a.phone()+"</span></div></div></div></div>",j=new google.maps.InfoWindow({content:i});google.maps.event.addListener(c,"click",function(){clearInfoWindow(),j.open(map,c),$(".locationItem").removeClass("active")}),a.marker=c,a.infoWindow=j,markers.push(c),infoWindows.push(j)}}function toggleBounce(){var a=this;a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null)},2150)}function clearInfoWindow(){for(var a=0;a<infoWindows.length;a++)infoWindows[a].close()}function reloadMarkers(){for(var a=0;a<markers.length;a++)markers[a].setMap(null);markers=[]}!function(){"use strict"}();var map,markers=[],infoWindows=[],locationLimit=7,FOURSQUARE_ID="YUHN3SIIMABMTH40QAZYJKEW3E3HCO2WZLCXKOFL20TCR1EO",FOURSQUARE_CLIENT="CGMIRXJIOWUY141LQSS0E4BXPEPNC5DOUQUT4SEET2XEF0XX",initialPlaces=[],Place=function(a){var b=this;this.id=ko.observable(a.id),this.name=ko.observable(a.name),this.lat=ko.observable(a.lat),this.lng=ko.observable(a.lng),this.address=ko.observable(a.address),this.phone=ko.observable(a.phone),this.fb=ko.observable(a.fb),this.url=ko.observable(a.url),this.photos=ko.observableArray(a.photos),this.isVisible=ko.observable(a.isVisible),this.isFavorite=ko.observable(a.isFavorite),this.rating=ko.observable(a.rating),this.category=ko.observable(a.category),this.icon=ko.computed(function(){return b.isFavorite()?"img/favorite-star.png":a.icon},this),this.starIcon=ko.computed(function(){return b.isFavorite()===!0?"img/star-gold.png":"img/star-grey.png"},this)},ViewModel=function(){function a(){b.Locationlist().forEach(function(a){a.infoWindow.close()})}var b=this;this.Locationlist=ko.observableArray([]),b.locationNameAuto=[];var c=JSON.parse(localStorage.initialPlaces);c.forEach(function(a){b.Locationlist.push(new Place(a)),b.locationNameAuto.push({label:a.name,id:a.id})}),this.Locationlist().forEach(makeMarker),this.selectedLocation=ko.observable(),this.showLocation=function(c){var d=c.marker,e=c.infoWindow;toggleBounce.bind(d)(),a(),e.open(map,d),b.selectedLocation(c)},this.toggleMakeFav=function(d){var e=d.marker,f=d.infoWindow,g=!d.isFavorite();d.isFavorite(g),g?e.setIcon("img/favorite-star.png"):e.setIcon(d.icon()),b.selectedLocation(d);var h=b.Locationlist().indexOf(b.selectedLocation());c[h].isFavorite=g,localStorage.initialPlaces=JSON.stringify(c),toggleBounce.bind(e)(),a(),f.open(map,e)},this.searchText=ko.observable(""),this.availableLocations=function(a){var c="",e=ko.observableArray(),f=b.searchText().toLowerCase();b.locationNameAuto.forEach(function(a){c=a.label.toLowerCase().indexOf(f),-1!==c&&e.push(a.id)}),d(e)};var d=function(a){reloadMarkers(),b.Locationlist().forEach(function(b){var c=ko.utils.arrayFirst(a(),function(a){return a===b.id()});b.isVisible(c)}),b.Locationlist().forEach(makeMarker)}},totalUpElementsHeights=$("#search").height()+$("#logo").height()+$("#content").height()+$(window).height()/6;$("#gmap").height($(window).height()-totalUpElementsHeights),$(window).resize(function(){var a=$("#search").height()+$("#logo").height()+$("#content").height()+$(window).height()/6;$("#gmap").height($(window).height()-a)});